name: sbom-checkov-config
on: [push, pull_request]
jobs:
  sbom:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Syft (pinned)
        run: |
          curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh \
          | sh -s -- -b /usr/local/bin v1.37.0
      - name: CycloneDX SBOM (repo)
        run: syft dir:. -o cyclonedx-json > sbom.repo.cdx.json
      - name: Validate CycloneDX
        run: |
          curl -sSL https://github.com/CycloneDX/cyclonedx-cli/releases/latest/download/cyclonedx-linux-x64 \
          -o /usr/local/bin/cyclonedx
          chmod +x /usr/local/bin/cyclonedx
          cyclonedx validate --input-file sbom.repo.cdx.json
      - uses: actions/upload-artifact@v4
        with: { name: sbom-repo, path: sbom.repo.cdx.json }
